version: '3.5'

services:
  broker:
    image: eclipse-mosquitto:1.6                                                                     
    ports:
      - '1883:1883'                                                                                                                                                                           
    # volumes:
    #   - ./mosquitto.conf:/mosquitto/config/mosquitto.conf
  influxdb:
    image: influxdb:1.8
    volumes:
    - influxdb-storage:/var/lib/influxdb
    environment:
      - INFLUXDB_DB=db0
      - INFLUXDB_ADMIN_USER=root
      - INFLUXDB_ADMIN_PASSWORD=pass
    ports:
      - "8086:8086"
    networks:
      - grafana-db

  grafana:
    image: grafana/grafana:8.2.6
    ports:
      - 80:3000
    environment:
      - GF_SECURITY_ADMIN_USER=asistent
      - GF_SECURITY_ADMIN_PASSWORD=grafanaSPRC2021
    volumes:
      - ./grafana-provisioning/dashboards:/etc/grafana/provisioning/dashboards
      - ./grafana-provisioning/datasources:/etc/grafana/provisioning/datasources
    depends_on:
      - influxdb
    networks:
      - grafana-db

volumes:
  grafana-storage: {}
  influxdb-storage: {}

networks:
  grafana-db:
    name: grafana-db